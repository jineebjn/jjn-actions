on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    # From here we just define all the steps that we have to do.
    steps:
      - name: Checkout Repo
        uses: actions/checkout@master
        
      # Install golang
      - name: Setup golang
        uses: actions/setup-go@v2
        with:
          go-version: 1.18

      - name: Installing Subfinder, HTTPX, Nuclei, Nikto, 
        run: |
          go get github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest
          sudo apt-get update
          sudo apt-get install nikto

          
      - name: Running Subfinder
        run: |
           mkdir -p output/$(head -1 targets.txt)
           subfinder -dL targets.txt -o output/$(head -1 targets.txt)/$(head -1 targets.txt)-subfinder-out.txt
            
      - name: Running HTTPX
        run: |
          cat output/$(head -1 targets.txt)/subfinder.txt output/$(head -1 targets.txt)/$(head -1 targets.txt)-subfinder-out.txt|httpx -silent -o output/$(head -1 targets.txt)/$(head -1 targets.txt)-httpx-out.txt
      
      - name: Running Nuclei
        run: |
            cat output/$(head -1 targets.txt) output/$(head -1 targets.txt)/$(head -1 targets.txt)-httpx-out.txt|nuclei -list output/$(head -1 targets.txt)/$(head -1 targets.txt)-httpx-out.txt -o output/$(head -1 targets.txt)/$(head -1 targets.txt)-nuclei-out.txt

      - name: Running Nikto
        run: |
            cat output/$(head -1 targets.txt) output/$(head -1 targets.txt)/$(head -1 targets.txt)-httpx-out.txt|nuclei -h output/$(head -1 targets.txt)/$(head -1 targets.txt)-httpx-out.txt -o output/$(head -1 targets.txt)/$(head -1 targets.txt)-nuclei-out.txt

      - name: Save domains
        run: |
          git config --local user.email "jineebjn@gmail.com"
          git config --local user.name "jineebjn"
          git add --all
          git commit -m "Updated"          
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: 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
