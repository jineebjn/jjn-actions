on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    # From here we just define all the steps that we have to do.
    steps:
      - name: Checkout Repo
        uses: actions/checkout@master
        
      # Setup golang
      - name: Setup golang
        uses: actions/setup-go@v2
        with:
          go-version: 1.19.5

      - name: Installing Subfinder and HTTPX
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install github.com/lc/gau/v2/cmd/gau@latest
      - name: Running Subfinder
        run: |
           mkdir -p output/$(head -1 targets.txt)
           subfinder -dL targets.txt -o output/$(head -1 targets.txt)/$(head -1 targets.txt)-subfinder-out.txt
            
      - name: Running HTTPX
        run: |
          cat output/$(head -1 targets.txt)/subfinder.txt output/$(head -1 targets.txt)/$(head -1 targets.txt)-subfinder-out.txt|httpx -silent -o output/$(head -1 targets.txt)/$(head -1 targets.txt)-httpx-out.txt
          
      - name: Save domains
        run: |
          git config --local user.email "jineebjn@gmail.com"
          git config --local user.name "jineebjn"
          git add --all
          git commit -m "Updated"          
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: 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
